[State : A Component's Memory](https://react.dev/learn/state-a-components-memory)
## State
컴포넌트는 상호 작용의 결과로 화면의 내용을 변경해야 하는 경우가 있다. 폼에 입력하면 입력 필드가 업데이트되어야 하고, "구매"를 클릭하면 상품이 장바구니에 담겨야 한다. 컴포넌트는 이런 값들을 기억해야 한다.
React는 이런 종류의 컴포넌트별 메모리를 **state**라고 부른다.

1. 지역 변수는 렌더링 간에 유지되지 않는다.
2. 지역 변수를 변경해도 렌더링을 일으키지 않는다.

컴포넌트를 새로운 데이터로 업데이트하기 위해선 다음 두 가지가 필요하다
1. 렌더링 간에 데이터를 유지하기 위한 **state 변수**
2. 변수를 업데이트하고 React가 컴포넌트를 다시 렌더링하도록 유발하는 **state setter 함수**

이를 위해 [[useState]]를 사용한다.
`use`로 시작하는 모든 함수를 [[훅]]이라고 한다.

### State는 격리되고 비공개로 유지된다
- State는 화면에서 컴포넌트 인스턴스에 지역적이다.
- 다시 말해, **동일한 컴포넌트를 두 번 렌더링한다면 각 복사본은 완전히 격리된 state를 가진다**

## 렌더링과 커밋
https://ko.react.dev/learn/render-and-commit

### 1단계: 렌더링 트리거
> [!tip] 손님의 주문을 주방으로 전달

컴포넌트 렌더링이 일어나는 데에는 두 가지 이유가 있다
#### 1. 컴포넌트의 초기 렌더링
앱이 시작될 때, `createRoot`를 호출해서 초기 렌더링이 이뤄진다.

#### 2. 컴포넌트의 state가 업데이트된 경우
컴포넌트의 상태를 업데이트하면 렌더링 동작이 자동으로 큐에 들어간다.

### 2단계 : React 컴포넌트 렌더링
> [!tip] 주방에서 주문 준비하기
> 

**렌더링**은 React에서 컴포넌트를 호출하는 것
- 초기 렌더링에서 React는 루트 컴포넌트를 호출
- 이후 렌더링에서 React는 state 업데이트가 일어나 렌더링을 트리거한 컴포넌트를 호출

### 3단계 : React가 DOM에 변경사항을 커밋
> [!tip] 테이블에 주문한 요리 내놓기

컴포넌트를 렌더링한 후 React는 DOM을 수정
- 초기 렌더링의 경우 React는 `appendChild()` DOM API를 사용해 생성한 모든 DOM 노드를 화면에 표시
- 리렌더링의 경우 필요한 최소한의 작업을 통해 DOM이 최신 렌더링 출력과 일치하도록

**React는 렌더링 간에 차이가 있는 경우에만 DOM 노드를 변경한다.**

## 스냅샷으로서의  state
https://ko.react.dev/learn/queueing-a-series-of-state-updates

### state를 설정하면 렌더링이 동작한다

### 렌더링은 그 시점의 스냅샷을 찍는다
렌더링이란 React가 컴포넌트 즉, 함수를 호출한다는 뜻.
해당 함수에서 반환하는 JSX는 시간상 UI의 스냅샷과 같다.

React가 컴포넌트를 리렌더링하는 과정
1. React가 함수를 다시 호출
2. 함수가 새로운 JSX 스냅샷을 반환
3. 반환된 스냅샷과 일치하도록 화면을 업데이트

즉 컴포넌트를 호출해 React가 UI의 스냅샷을 찍을 때 값은 고정된다

## State 업데이트 큐
state 변수를 설정하면 다음 렌더링이 큐에 들어간다. 그러나 다음 렌더링을 큐에 넣기 전에, 값에 대해 여러 작업을 수행하고 싶을 때도 있다. 이를 위해서는 React가 state 업데이트를 어떻게 배치하면 좋을지 이해하는 것이 도움이 된다.

### React state batches 업데이트
React는 state 업데이트를 하기 전에 이벤트 핸들러의 모든 코드가 실행될 때까지 기다린다.
물론, 안전한 경우에만 batch를 수행한다.

- state를 설정하더라도 기존 렌더링의 변수는 변경되지 않으며, 대신 새로운 렌더링을 요청합니다.
- React는 이벤트 핸들러가 실행을 마친 후 state 업데이트를 처리합니다. 이를 batching 이라고 합니다.
- 하나의 이벤트에서 일부 state를 여러 번 업데이트하려면 `setNumber(n => n + 1)` 업데이터 함수를 사용할 수 있습니다.
